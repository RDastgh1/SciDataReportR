% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/PlotSplitViolin.R
\name{PlotSplitViolin}
\alias{PlotSplitViolin}
\title{Split violin with aligned half-boxplots and a centered significance label}
\usage{
PlotSplitViolin(
  data,
  Var,
  Group,
  covars = c("Age"),
  nonparametric = FALSE,
  annotation_text = NULL,
  show_ns = FALSE,
  left_group = NULL,
  color_palette = NULL,
  box_offset = 0.11,
  box_width = 0.15,
  star_from = c("quantile", "data_max", "whisker"),
  star_quantile = 0.995,
  star_pad = 0.03,
  headroom = 0.08,
  star_size = 6
)
}
\arguments{
\item{data}{A data frame containing \code{Var}, \code{Group}, and any covariates.}

\item{Var}{Column of the numeric outcome to plot. Tidy-eval friendly (unquoted or string).}

\item{Group}{Column of the grouping variable. Must have 1 or 2 unique values.
No factor relabeling is performed inside; set levels externally if needed.}

\item{covars}{Character vector of covariate column names (default \code{"Age"}).
Use \code{character(0)} for no covariates.}

\item{nonparametric}{Logical. If \code{FALSE} (default), compute the p-value using
a linear model and an \pkg{emmeans} contrast on \code{Group}. If \code{TRUE}:
with no covariates, use Wilcoxon rank-sum on \code{Var ~ Group}; with covariates,
first residualize \code{Var} on the covariates (no \code{Group}), then apply Wilcoxon
rank-sum to the residuals by \code{Group}. With only one group, no test is performed.}

\item{annotation_text}{Optional label to draw (e.g., \code{"*"}, \code{"**"}, \code{"***"},
\code{"ns"}, \code{"â˜…"}). If \code{NULL}, the label is derived from the computed p-value.}

\item{show_ns}{Logical; if \code{TRUE}, show \code{"ns"} for non-significant results
when \code{annotation_text} is \code{NULL}.}

\item{left_group}{Optional. The \code{Group} value to place on the \strong{left} half.
If omitted, the first factor level (or first observed value) is used.}

\item{color_palette}{Optional color specification. Supply a named vector keyed
by \code{Group} values; if unnamed, values are interpreted as \verb{(left, right)}.}

\item{box_offset}{Horizontal offset for the left/right boxplots from the center
(single x = 1). Small values (e.g., \code{0.10-0.14}) sit the boxes inside each half.}

\item{box_width}{Boxplot width (default \code{0.15}). For clean separation,
keep \code{box_width <= 2 * box_offset}.}

\item{star_from}{Where to anchor the vertical position of the significance label:
one of \code{"quantile"} (default), \code{"data_max"}, or \code{"whisker"}.}

\item{star_quantile}{Quantile used when \code{star_from = "quantile"} (default \code{0.995}).}

\item{star_pad}{Fraction of the y-range added above the anchor for the label (default \code{0.03}).}

\item{headroom}{Fraction of the y-range added to the top limit to avoid clipping (default \code{0.08}).}

\item{star_size}{Text size for the significance label (default \code{6}).}
}
\value{
A \pkg{ggplot2} object.
}
\description{
Draws a split (left/right) violin for up to two groups at a single x-position,
overlays per-group boxplots aligned with each half, and optionally annotates
the plot with a p-value significance label (e.g., "\emph{", "\strong{", "}}", "ns").
The y-axis title is taken from the variable's label attribute when available
(via \pkg{labelled} or \pkg{Hmisc}); otherwise the column name is used.
}
\details{
\strong{Geometry and alignment.} Each half of the violin is drawn with
\code{gghalves::geom_half_violin()}, then two explicit boxplot layers (left and right)
are drawn at fixed x-positions (\code{1 - box_offset} and \code{1 + box_offset}), so the boxes
always align with their corresponding half and color (no dodging flips).

\strong{Significance label.} When \code{annotation_text} is \code{NULL}, the p-value is computed
as described and converted to \code{"*"}, \code{"**"}, \code{"***"}, or (optionally) \code{"ns"}.
The label is drawn at x = 1 via \code{ggpubr::stat_pvalue_manual(remove.bracket = TRUE)}.
Vertical placement is \code{anchor + star_pad * (range_y)}, where the anchor is
chosen by \code{star_from}. The top limit is expanded by \code{headroom} so the label never clips.

\strong{Axis label.} If \code{Var} has a \code{label} attribute (from \pkg{labelled} or \pkg{Hmisc}),
that text is used for the y-axis title; otherwise the column name is used.
}
\examples{
\dontrun{
PlotSplitViolin(df_analysis, Var = Tryptophan, Group = STATUS)
PlotSplitViolin(
  df_analysis, Var = Tryptophan, Group = STATUS,
  left_group = "Seropositive",
  color_palette = c(Seropositive = "#E8A007", Seronegative = "#8C1A45")
)
PlotSplitViolin(df_analysis, Var = Tryptophan, Group = STATUS,
                covars = "Age", nonparametric = FALSE)
PlotSplitViolin(df_analysis, Var = Tryptophan, Group = STATUS,
                covars = "Age", nonparametric = TRUE, show_ns = TRUE)
}
}
\seealso{
\code{\link[gghalves]{geom_half_violin}}, \code{\link[ggpubr]{stat_pvalue_manual}},
\code{\link[emmeans]{emmeans}}
}
