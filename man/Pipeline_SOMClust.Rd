% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Pipeline_SOMClust.R
\name{Pipeline_SOMClust}
\alias{Pipeline_SOMClust}
\title{SOM + latent profile clustering pipeline (with AHP and distance baselines)}
\usage{
Pipeline_SOMClust(
  df,
  variables = NULL,
  method = c("exploratory", "finalize"),
  k_range = 2:15,
  models = c(1, 2, 3),
  final_k = NULL,
  final_model = NULL,
  ClusterName = "Cluster",
  ZScoreType = c("Center and Scale", "Center Only", "Scale Only", "ZScoreObj"),
  ZScoreObject = NULL,
  som_xdim = NULL,
  som_ydim = NULL,
  som_topo = "hexagonal",
  som_neigh = "gaussian",
  seed_som = 934521L,
  seed_lpa = 93421L,
  Relabel = TRUE
)
}
\arguments{
\item{df}{Data frame containing the variables to be used in SOM and
clustering.}

\item{variables}{Optional character vector of variable names. If NULL,
numeric variables are auto-detected using
\code{SciDataReportR::getNumVars(df, Ordinal = FALSE)}.}

\item{method}{One of \code{"exploratory"} (default) or \code{"finalize"}.
In \code{"exploratory"}, a grid of models is fit and AHP chooses the
recommended solution. In \code{"finalize"}, the user must specify
\code{final_k} and \code{final_model}.}

\item{k_range}{Integer vector of numbers of clusters/profiles to consider
in exploratory mode. Default \code{2:15}.}

\item{models}{Integer vector of model specifications for tidyLPA
(mclust backend). Default \code{c(1, 2, 3)}.}

\item{final_k}{Integer; number of profiles for \code{method = "finalize"}.}

\item{final_model}{Integer; model specification for \code{method = "finalize"}
(should be one of \code{models}).}

\item{ClusterName}{Name of the cluster column in the output. Defaults to
\code{"Cluster"}. If this column already exists in \code{df}, it is
overwritten (with a message).}

\item{ZScoreType}{One of:
\itemize{
\item \code{"Center and Scale"} (default)
\item \code{"Center Only"}
\item \code{"Scale Only"}
\item \code{"ZScoreObj"} (use an existing ZScore object)
}}

\item{ZScoreObject}{Optional ZScoreObj (from \code{CalcZScore()} or
\code{Project_ZScore()}) to use when \code{ZScoreType = "ZScoreObj"}.}

\item{som_xdim, som_ydim}{Optional integers for SOM grid dimensions. If NULL,
a square grid with side length \code{ceiling(n_complete^(1/3))} is used.}

\item{som_topo}{SOM topology for \code{kohonen::somgrid()}, default
\code{"hexagonal"}.}

\item{som_neigh}{SOM neighbourhood function, default \code{"gaussian"}.}

\item{seed_som, seed_lpa}{Integer seeds for SOM and LPA steps
(defaults 934521 and 93421).}

\item{Relabel}{Logical; if TRUE (default), aweSOM plots are relabeled
using variable labels from \code{df} (via Hmisc or sjlabelled when
available).}
}
\value{
A list of class \code{"Pipeline_SOMClust"} with components:
\itemize{
\item \code{method}, \code{vars_used}, \code{ZScoreType},
\code{ZScoreObject}, \code{ClusterName}
\item \code{complete_rows}: logical vector (rows used for SOM/LPA)
\item \code{df_with_clusters}: original \code{df} with only the
cluster column appended
\item \code{fit_plot}: ggplot of AIC/BIC/Entropy vs k and model
\item \code{ModelInfo_SOM}: list with \code{som_model},
\code{som_codes}, \code{som_grid}, \code{SOMFit} (distance
diagnostics, baselines, and per-cluster flags), \code{plots}
(aweSOM plots)
\item \code{ModelInfo_MClust}: list with \code{lpa_models},
\code{fit_table}, and \code{AHP} information
\item \code{ProbFit}: list with \code{node} (node-level posterior
probabilities), \code{individual} (per-person mapping and
probabilities), and probability plots
}
}
\description{
End-to-end pipeline to:
\itemize{
\item Standardize variables using SciDataReportR::CalcZScore() or a supplied
Z-score object.
\item Fit a Self-Organizing Map (SOM; kohonen) on complete cases.
\item Generate aweSOM visualizations (Circular, Line, Cloud) with optional
relabeling using variable labels from the original data frame.
\item Cluster SOM codebook vectors using latent profile analysis (tidyLPA /
mclust backend).
\item In \code{method = "exploratory"}, fit a grid of models and select a
recommended solution using an Analytic Hierarchy Process (AHP)-style
index combining AIC, BIC, and Entropy.
\item In \code{method = "finalize"}, fit a user-specified model and number
of profiles.
\item Map node-level clusters and posterior probabilities back to individuals.
}

Missing data:
\itemize{
\item SOM and clustering are fit only on rows with complete Z-scores.
\item The returned \code{df_with_clusters} has the full original data with
a single cluster column appended; rows not used in SOM/LPA get NA.
}
}
\details{
The AHP-style index is computed by:
\enumerate{
\item Scaling AIC, BIC, and Entropy across candidate solutions
(AIC/BIC are negated so that lower values correspond to better
fit; higher scaled scores are preferred).
\item Taking the mean of the three scaled indices. The model with the
highest AHP index is recommended.
}
}
\references{
Saaty TL. \emph{The Analytic Hierarchy Process}. McGrawâ€“Hill, 1980.
}
