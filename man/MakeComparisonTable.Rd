% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MakeComparisonTable.R
\name{MakeComparisonTable}
\alias{MakeComparisonTable}
\title{Make a publication-ready comparison table using gtsummary}
\usage{
MakeComparisonTable(
  DataFrame,
  CompVariable,
  Variables = NULL,
  ...,
  Covariates = NULL,
  ValueDigits = 2,
  pDigits = 3,
  AddEffectSize = FALSE,
  EffectSizeDigits = 2,
  AddPairwise = FALSE,
  PairwiseMethod = "bonferroni",
  Parametric = TRUE,
  ParametricDisplay = NULL,
  IncludeOverallN = FALSE,
  IncludeMissing = FALSE,
  suppress_warnings = FALSE,
  Referent = NULL,
  IncludeOverallStats = FALSE,
  ShowPositiveBinaryOnLabel = TRUE,
  BinaryPairwiseScale = "logit",
  CatMethod = "auto",
  MultiCatAdjusted = "multinomial_LR",
  IncludeNotes = TRUE
)
}
\arguments{
\item{DataFrame}{A data frame or tibble.}

\item{CompVariable}{A single character string naming the grouping variable.}

\item{Variables}{Character vector of variables to compare. Default NULL compares all other variables.}

\item{...}{Optional unnamed character variable names to append to \code{Variables}.}

\item{Covariates}{Character vector of covariates used only for adjusted tests and adjusted pairwise. Default NULL.}

\item{ValueDigits}{Digits for continuous summaries. Default 2.}

\item{pDigits}{Digits for p-value formatting. Default 3.}

\item{AddEffectSize}{Logical; add effect size column. Default FALSE.}

\item{EffectSizeDigits}{Digits for effect size formatting. Default 2.}

\item{AddPairwise}{Logical; add pairwise columns. Default FALSE.}

\item{PairwiseMethod}{Multiplicity correction for pairwise p-values. Default "bonferroni".
Must be one of \code{stats::p.adjust.methods} or "none". Empty inputs are normalized to the default.}

\item{Parametric}{Logical; if TRUE use parametric tests for continuous, else robust or nonparametric. Default TRUE.}

\item{ParametricDisplay}{Logical or NULL; if NULL uses \code{Parametric}. Default NULL.}

\item{IncludeOverallN}{Logical; add N column via \code{gtsummary::add_n()}. Default FALSE.}

\item{IncludeMissing}{Logical; include missing rows in summary. Default FALSE.}

\item{suppress_warnings}{Logical; suppress warnings from \code{tbl_summary()}. Default FALSE.}

\item{Referent}{Optional character level of \code{CompVariable} for referent-based pairwise. Default NULL (all pairwise).}

\item{IncludeOverallStats}{Logical; if TRUE ignores grouping and returns overall summary. Default FALSE.}

\item{ShowPositiveBinaryOnLabel}{Logical; attempt to set display "positive" level for dichotomous variables. Default TRUE.}

\item{BinaryPairwiseScale}{Reserved; currently not used for tests, but kept for API stability. Default "logit".}

\item{CatMethod}{Character; "auto", "chisq", or "fisher". Default "auto".}

\item{MultiCatAdjusted}{Character; default "multinomial_LR". Kept explicit to avoid silent breaks.}

\item{IncludeNotes}{Logical; include Notes column (and force it last). Default TRUE.}
}
\value{
A \code{gtsummary} object (\code{tbl_summary}) with added columns in \verb{$table_body}.
}
\description{
Creates a \code{gtsummary::tbl_summary()} table comparing groups defined by \code{CompVariable},
then appends deterministic, label-friendly columns for global p-values, optional covariate-adjusted p-values,
optional effect sizes, optional pairwise contrasts, and an optional Notes column documenting complete-case
level drops.
}
\details{
The function is designed to be usable with just:
\preformatted{
MakeComparisonTable(df, "GroupVar")
}
}
\section{Defaults and intended usage}{

\itemize{
\item \code{Variables = NULL} (default): compare \strong{all columns} in \code{DataFrame} except \code{CompVariable} and any \code{Covariates}.
\item \code{Covariates = NULL} (default): no covariate adjustment.
\item \code{Parametric = TRUE} (default): parametric global tests for continuous outcomes.
\item \code{ParametricDisplay = NULL} (default): uses mean (SD) if \code{Parametric=TRUE}, and median \link{IQR} if \code{Parametric=FALSE}.
\item \code{CatMethod = "auto"} (default): chi-squared when valid; Fisher (exact for 2x2, simulated otherwise) when chi-squared assumptions fail.
\item \code{MultiCatAdjusted = "multinomial_LR"} (default): multinomial likelihood ratio test for adjusted multi-category outcomes.
\item \code{AddPairwise = FALSE} (default): do not include pairwise columns unless requested.
\item \code{PairwiseMethod = "bonferroni"} (default): p-value correction for pairwise contrasts.
If \code{PairwiseMethod} is passed as \code{NULL}, \code{""}, \code{NA}, or \code{character(0)} (common from grid code),
it is normalized back to \code{"bonferroni"}.
\item \code{IncludeNotes = TRUE} (default): include Notes describing dropped group levels due to complete-case filtering.
Notes is always forced to the last column when included.
}
}

\section{Statistical tests}{
 continuous outcomes

\strong{Unadjusted (no covariates)}
\itemize{
\item \code{Parametric = TRUE}
\itemize{
\item 2 groups: Welch t-test (\code{stats::t.test}, unequal variances)
\item 3+ groups: ANOVA (\code{stats::aov})
}
\item \code{Parametric = FALSE}
\itemize{
\item 2 groups: Wilcoxon rank-sum (\code{stats::wilcox.test})
\item 3+ groups: Kruskal-Wallis (\code{stats::kruskal.test})
}
}

\strong{Adjusted (with covariates)}
\itemize{
\item \code{Parametric = TRUE}: ANCOVA via \code{lm()}, Type II F test for group term via \code{car::Anova(type=2)}.
\item \code{Parametric = FALSE}: robust ANCOVA via \code{lm()} with HC3 covariance from \code{sandwich::vcovHC(type="HC3")},
Wald Type II F test via \code{car::Anova(vcov.=V, test.statistic="F")}.
}

Complete-case filtering is performed per variable:
\itemize{
\item Unadjusted tests: complete cases on \verb{\{outcome, CompVariable\}}
\item Adjusted tests: complete cases on \verb{\{outcome, CompVariable, Covariates\}}
This may drop group levels; those dropped levels are reported in Notes (if enabled),
and pairwise contrasts involving dropped levels are returned as \code{NA}.
}

 continuous pairwise

\strong{Unadjusted}
\itemize{
\item \code{Parametric = TRUE}: \code{stats::pairwise.t.test(pool.sd = FALSE)}
\item \code{Parametric = FALSE}: \code{stats::pairwise.wilcox.test}
\item multiplicity correction via \code{PairwiseMethod} (or none if \code{"none"})
}

\strong{Adjusted}
\itemize{
\item Fits \code{lm(outcome ~ group + covariates)} on complete cases.
\item Pairwise via \code{emmeans}:
\itemize{
\item robust mode passes HC3 covariance into \code{emmeans::emmeans(..., vcov. = V)} so adjusted pairwise works.
\item if \code{Referent} is provided: treatment-vs-control contrasts vs referent via \code{emmeans::contrast(..., "trt.vs.ctrl")}
otherwise all pairwise via \code{"pairwise"}.
}
}

 categorical outcomes

\strong{Unadjusted global tests}
\itemize{
\item \code{CatMethod="chisq"}: Pearson chi-squared (\code{stats::chisq.test})
\item \code{CatMethod="fisher"}: Fisher exact for 2x2; Fisher simulated for larger tables
\item \code{CatMethod="auto"}: chi-squared unless expected counts are small or zero, then Fisher
}

\strong{Adjusted global tests (with covariates)}
\itemize{
\item Binary outcome: logistic regression likelihood ratio test (LR) comparing reduced vs full model
\item Multi-category (3+ levels): multinomial LR using \code{nnet::multinom} comparing reduced vs full model
(controlled by \code{MultiCatAdjusted}, default \code{"multinomial_LR"})
}

\strong{Adjusted pairwise for categorical (with covariates)}
For each pairwise subset, outcome levels may collapse. The engine detects per pair:
\itemize{
\item If outcome becomes binary: logistic LR
\item If outcome remains 3+ levels: multinomial LR
}
}

\references{
\itemize{
\item gtsummary: https://www.danieldsjoberg.com/gtsummary/
\item emmeans: https://cran.r-project.org/package=emmeans
\item car::Anova Type II: https://cran.r-project.org/package=car
\item sandwich HC3: https://cran.r-project.org/package=sandwich
\item effectsize: https://cran.r-project.org/package=effectsize
\item nnet::multinom: https://cran.r-project.org/package=nnet
}
}
