% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MakeComparisonTable.R
\name{MakeComparisonTable}
\alias{MakeComparisonTable}
\title{Make a publication-ready comparison table (gtsummary backbone)}
\usage{
MakeComparisonTable(
  DataFrame,
  CompVariable,
  Variables = NULL,
  ...,
  Covariates = NULL,
  ValueDigits = 2,
  pDigits = 3,
  AddEffectSize = FALSE,
  EffectSizeDigits = 2,
  AddPairwise = FALSE,
  PairwiseMethod = "bonferroni",
  Parametric = TRUE,
  ParametricDisplay = NULL,
  IncludeOverallN = FALSE,
  IncludeMissing = FALSE,
  suppress_warnings = FALSE,
  Referent = NULL,
  IncludeOverallStats = FALSE,
  ShowPositiveBinaryOnLabel = TRUE,
  BinaryPairwiseScale = c("logit", "prob"),
  CatMethod = c("auto", "chisq", "fisher"),
  MultiCatAdjusted = c("multinomial_LR"),
  IncludeNotes = TRUE
)
}
\arguments{
\item{DataFrame}{A data frame.}

\item{CompVariable}{A single character name of the grouping variable.}

\item{Variables}{Character vector of variables to summarize. Default \code{NULL} means all columns
except \code{CompVariable} and \code{Covariates}.}

\item{...}{Optional unnamed character variable names to append to \code{Variables}.}

\item{Covariates}{Character vector of covariate names used only for adjusted tests. Default \code{NULL}.}

\item{ValueDigits}{Digits for continuous summary statistics. Default \code{2}.}

\item{pDigits}{Digits for formatted p-values. Default \code{3}.}

\item{AddEffectSize}{Logical. Add an effect size column. Default \code{FALSE}.}

\item{EffectSizeDigits}{Digits for effect size formatting. Default \code{2}.}

\item{AddPairwise}{Logical. Add pairwise p-value columns. Default \code{FALSE}.}

\item{PairwiseMethod}{Multiple comparisons adjustment. One of \code{"none"} or \code{stats::p.adjust.methods}.
Default \code{"bonferroni"}. If passed as \code{NULL}/empty it falls back to \code{"bonferroni"}.}

\item{Parametric}{Logical. Use parametric tests (or robust ANCOVA when covariates exist) vs nonparametric.
Default \code{TRUE}.}

\item{ParametricDisplay}{Logical. Controls how continuous variables are displayed:
mean (SD) when \code{TRUE}, median \link{IQR} when \code{FALSE}. Default \code{NULL} which uses \code{Parametric}.}

\item{IncludeOverallN}{Logical. Add an N column via \code{gtsummary::add_n()}. Default \code{FALSE}.}

\item{IncludeMissing}{Logical. Include missing row in summaries. Default \code{FALSE}.}

\item{suppress_warnings}{Logical. Suppress warnings from \code{gtsummary::tbl_summary}. Default \code{FALSE}.}

\item{Referent}{Optional referent level for pairwise contrasts. Default \code{NULL} (all pairwise).}

\item{IncludeOverallStats}{Logical. If \code{TRUE} or \code{CompVariable} is \code{NULL}, return overall-only table.
Default \code{FALSE}.}

\item{ShowPositiveBinaryOnLabel}{Logical. If \code{TRUE}, attempt to show “positive” level for dichotomous.
Default \code{TRUE}.}

\item{BinaryPairwiseScale}{Not used in current implementation (reserved). Default \code{c("logit","prob")}.}

\item{CatMethod}{Global categorical method: \code{"auto"}, \code{"chisq"}, or \code{"fisher"}. Default \code{"auto"}.}

\item{MultiCatAdjusted}{Adjusted multi-category method. Default \code{"multinomial_LR"}.}

\item{IncludeNotes}{Logical. Include Notes column (dropped-group info). Default \code{TRUE}.}
}
\value{
A \code{gtsummary} object (\code{tbl_summary}) with added columns for p-values, tests,
optional effect sizes, optional pairwise p-values, and optional Notes.
}
\description{
Wraps \code{gtsummary::tbl_summary()} and appends deterministic, label-friendly columns for
global p-values (unadjusted and optionally covariate-adjusted), optional effect sizes,
and optional pairwise contrasts with multiple-comparisons adjustment and optional referent.
}
\details{
The function is designed to be predictable: defaults are set for all arguments except
\code{DataFrame} and \code{CompVariable}, and outputs are stable across runs.
\subsection{Defaults and “just run it” behavior}{
\itemize{
\item If \code{Variables} is \code{NULL} (default), all columns in \code{DataFrame} are summarized \strong{except}
\code{CompVariable} and any \code{Covariates}.
\item If covariates appear in \code{Variables}, they are removed with a warning.
\item If \code{PairwiseMethod} is \code{NULL}, \code{character(0)}, \code{""}, or \code{NA}, it defaults to \code{"bonferroni"}.
This avoids failures when calling the function via \code{do.call()} with partially specified args.
}
}

\subsection{Continuous outcomes: global tests}{

\strong{No covariates (\code{Covariates = NULL})}
\itemize{
\item Parametric (\code{Parametric = TRUE}):
\itemize{
\item 2 groups: Welch t-test (\code{stats::t.test})
\item 3+ groups: ANOVA (\code{stats::aov})
}
\item Nonparametric (\code{Parametric = FALSE}):
\itemize{
\item 2 groups: Wilcoxon rank-sum (\code{stats::wilcox.test})
\item 3+ groups: Kruskal-Wallis (\code{stats::kruskal.test})
}
}

\strong{With covariates (\code{Covariates} provided)}
\itemize{
\item Parametric (\code{Parametric = TRUE}): ANCOVA via \code{stats::lm} with Type II test for the group term
using \code{car::Anova(type = 2)}.
\item Robust (\code{Parametric = FALSE}): robust ANCOVA via \code{stats::lm} with HC3 covariance
(\code{sandwich::vcovHC(type = "HC3")}) and a Type II Wald F test via \code{car::Anova(vcov. = V, test.statistic="F")}.
}

Complete-case filtering is applied per variable:
\itemize{
\item Unadjusted tests filter on \code{outcome + CompVariable}
\item Adjusted tests filter on \code{outcome + CompVariable + Covariates}
This can drop whole group levels for a variable. Those dropped levels are reported in \code{Notes}
(if \code{IncludeNotes = TRUE}) and any pairwise contrasts involving the dropped level are \code{NA}.
}
}

\subsection{Continuous outcomes: pairwise tests}{

\strong{No covariates}
\itemize{
\item Parametric: \code{stats::pairwise.t.test(pool.sd = FALSE)} (Welch-style) with \code{p.adjust.method}
\item Nonparametric: \code{stats::pairwise.wilcox.test} with \code{p.adjust.method}
}

\strong{With covariates}
\itemize{
\item Always uses \code{emmeans} on the adjusted \code{lm} model.
\item Robust mode passes the robust covariance matrix into \code{emmeans::emmeans(..., vcov. = V)}
so adjusted pairwise still works in robust mode.
}

Referent handling:
\itemize{
\item If \code{Referent} is provided, uses treatment-vs-control (\code{emmeans::contrast(..., method="trt.vs.ctrl")})
\item Otherwise uses all pairwise (\code{method="pairwise"})
}
}

\subsection{Categorical outcomes: global tests (unadjusted)}{

Controlled by \code{CatMethod}:
\itemize{
\item \code{"chisq"}: Pearson chi-squared (\code{stats::chisq.test})
\item \code{"fisher"}: Fisher exact for 2x2; simulation-based Fisher for larger tables
\item \code{"auto"} (default): chi-squared when assumptions are acceptable; otherwise Fisher
(fallback triggered by small expected counts or failures).
}
}

\subsection{Categorical outcomes: adjusted tests (with covariates)}{
\itemize{
\item Binary outcome: logistic regression likelihood ratio test for the group term
using \code{stats::glm(..., family=binomial())} and \code{stats::drop1(test="Chisq")}.
\item Multi-category outcome (3+ levels): multinomial LR test via \code{nnet::multinom}
comparing reduced vs full model using \code{stats::anova(test="Chisq")} (with a logLik-based fallback).
\item \code{MultiCatAdjusted} currently supports \code{"multinomial_LR"} only and defaults to it
so users don’t accidentally fall into a missing-method pit.
}

Adjusted pairwise for categorical outcomes:
\itemize{
\item For each pairwise subset, the outcome can collapse (e.g., 3 levels overall becomes 2 levels in a pair).
\item The function detects this per pair:
\itemize{
\item If collapsed to 2 levels: logistic LR
\item If still 3+ levels: multinomial LR
}
}
}

\subsection{Effect sizes (optional)}{

When \code{AddEffectSize = TRUE}, an \code{effect_size} column is added on the label row.
\itemize{
\item Continuous: partial eta-squared (η²p) for the group term using \code{effectsize::eta_squared}
(adjusted model if covariates exist; otherwise ANOVA model).
\item Categorical: Cramer’s V from the unadjusted contingency table using \code{effectsize::cramers_v}.
}

Effect sizes are intended as descriptive magnitudes; they do not change the hypothesis tests.
}

\subsection{P-values}{

To avoid numeric underflow returning exactly 0, numeric p-values are clamped to
\code{.Machine$double.xmin} before formatting.
}

\subsection{Caption}{

A deterministic caption is built with \code{gtsummary::modify_caption()} summarizing:
\itemize{
\item continuous display (mean (SD) vs median \link{IQR})
\item parametric vs robust mode
\item covariate adjustment (and which covariates)
\item categorical method (\code{CatMethod})
\item multi-category adjusted method (\code{MultiCatAdjusted})
\item whether pairwise was included and the p-adjust method.
}
}
}
\examples{
\dontrun{
tbl <- MakeComparisonTable(df, "Cluster")
tbl2 <- MakeComparisonTable(df, "Cluster", Covariates = c("Age","Sex"), AddPairwise = TRUE)
}
}
