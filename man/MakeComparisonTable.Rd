% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MakeComparisonTable.R
\name{MakeComparisonTable}
\alias{MakeComparisonTable}
\title{Make comparison table with covariate adjustment, effect sizes, and pairwise contrasts}
\usage{
MakeComparisonTable(
  DataFrame,
  CompVariable = NULL,
  Variables,
  ...,
  Covariates = NULL,
  ValueDigits = 2,
  pDigits = 3,
  AddEffectSize = FALSE,
  EffectSizeDigits = 2,
  AddPairwise = FALSE,
  PairwiseMethod = "bonferroni",
  Parametric = TRUE,
  ParametricDisplay = NULL,
  IncludeOverallN = FALSE,
  IncludeMissing = FALSE,
  suppress_warnings = FALSE,
  Referent = NULL,
  IncludeOverallStats = FALSE,
  ShowPositiveBinaryOnLabel = TRUE,
  BinaryPairwiseScale = c("logit", "prob"),
  CatMethod = "auto"
)
}
\arguments{
\item{DataFrame}{A data frame.}

\item{CompVariable}{Grouping variable name (character scalar). If \code{NULL} or not present and
\code{IncludeOverallStats = TRUE}, an overall-only table is returned.}

\item{Variables}{Character vector of variables to include. You may also pass additional
variable names as unnamed arguments via \code{...} (convenience).}

\item{...}{Optional additional variable names (character scalars).}

\item{Covariates}{Optional covariate names (character vector) used for adjusted models.
Any variables listed here are automatically removed from \code{Variables} so they do not appear
as rows in the output table.}

\item{ValueDigits}{Digits for summary statistics (default 2).}

\item{pDigits}{Digits to display p-values (default 3). Formatting uses \code{format.pval}.}

\item{AddEffectSize}{Add effect sizes column (default FALSE).}

\item{EffectSizeDigits}{Digits for effect sizes (default 2).}

\item{AddPairwise}{Add pairwise p-value columns (default FALSE).}

\item{PairwiseMethod}{P-adjustment method (default "bonferroni"). Use "none" for no adjustment.
Must be one of \code{"none"} or \code{stats::p.adjust.methods}.}

\item{Parametric}{If TRUE, use parametric tests for continuous outcomes where relevant.
If FALSE and covariates are present, robust ANCOVA is used for continuous outcomes.}

\item{ParametricDisplay}{If TRUE show mean (SD); if FALSE show median \link{IQR}. Defaults to \code{Parametric}.}

\item{IncludeOverallN}{If TRUE add overall N column.}

\item{IncludeMissing}{If TRUE include missing/unknown category rows in summaries.}

\item{suppress_warnings}{If TRUE suppress gtsummary warnings.}

\item{Referent}{Optional reference level for pairwise contrasts (character scalar). If set,
pairwise comparisons are against this referent.}

\item{IncludeOverallStats}{If TRUE return overall-only summary (ignores grouping).}

\item{ShowPositiveBinaryOnLabel}{If TRUE, display only the “positive” level for binary categorical variables.}

\item{BinaryPairwiseScale}{For adjusted binary outcomes: "logit" (default) contrasts on the logit scale,
or "prob" for probability-scale delta-method contrasts.}

\item{CatMethod}{Categorical test method: "auto" (default), "chisq", or "fisher".}
}
\value{
A \code{gtsummary::tbl_summary} object.
}
\description{
Create a label-friendly comparison table (via \strong{gtsummary}) that summarizes variables
across groups, adds global tests, optional covariate adjustment, effect sizes, and
optional pairwise comparisons. Designed for “publication table” workflows where you
want the \strong{Test} column to reflect the method that generated the p-values.
}
\details{
\subsection{What gets tested (global p-value)}{

The global p-value shown for each variable depends on variable type and options:

\strong{Continuous outcomes}
\itemize{
\item \code{Parametric = TRUE}, no covariates:
\itemize{
\item 2 groups: Welch two-sample t test (\code{stats::t.test}, unequal variances by default).
\item 3+ groups: one-way ANOVA (\code{stats::aov}).
}
\item Covariates present:
\itemize{
\item \code{Parametric = TRUE}: ANCOVA via linear model (\code{stats::lm}) with Type II test for the grouping term
(\code{car::Anova(type = 2)}).
\item \code{Parametric = FALSE}: Robust ANCOVA via \code{stats::lm} with \strong{HC3} robust covariance
(\code{sandwich::vcovHC(type = "HC3")}) and a Wald F test using \code{car::linearHypothesis}.
}
}

\strong{Categorical outcomes} (dichotomous or multi-category)
\itemize{
\item Global test is Pearson chi-squared (\code{stats::chisq.test(correct = FALSE)}) by default.
\item If \code{CatMethod = "auto"}, Fisher’s exact test is used when expected counts are small.
\item If covariates are present and the outcome is \strong{binary}, an adjusted global test is
provided via logistic regression likelihood-ratio test (\code{stats::drop1(test="Chisq")}).
}
}

\subsection{What gets tested (pairwise p-values)}{

Pairwise p-values are intended to match the method implied by the \strong{Test} column:

\strong{Continuous outcomes}
\itemize{
\item No covariates, \code{Parametric = TRUE}: \code{stats::pairwise.t.test(pool.sd = FALSE)}.
\item No covariates, \code{Parametric = FALSE}: \code{stats::pairwise.wilcox.test}.
\item With covariates: pairwise comparisons of adjusted means using \code{emmeans::emmeans} +
\code{emmeans::pairs} (or treatment-vs-control if \code{Referent} is set).
}

\strong{Important note about adjusted continuous pairwise}
This function uses complete-case rows for each outcome (outcome + group + covariates).
After complete-case filtering, some covariates can become constant (for example, all remaining
participants share the same Sex), or some group levels can disappear. That can make the model
rank-deficient and prevent \code{emmeans} from estimating certain contrasts.

To avoid blank pairwise columns due to purely technical issues, this function:
\itemize{
\item Removes the outcome variable from covariates per-row (prevents \code{y} on both sides),
\item Drops covariates that are constant after complete-case filtering,
\item Falls back to unadjusted pairwise if no usable covariates remain for that outcome.
}

If pairwise values are still \code{NA}, that typically reflects truly non-estimable contrasts
(data limitation), not a join or formatting failure.

\strong{Categorical outcomes}
\itemize{
\item No covariates: pairwise chi-squared or Fisher (per \code{CatMethod}) on 2x2 or Rx2 subtables.
\item With covariates and binary outcome: pairwise Wald z tests of linear predictor contrasts
from logistic regression (coefficient-contrast behavior).
}
}

\subsection{Effect sizes}{
\itemize{
\item Continuous, 2 groups, unadjusted: |Cohen’s d| (\code{effectsize::cohens_d}).
\item Continuous, 3+ groups, unadjusted parametric: eta-squared (\code{effectsize::eta_squared}).
\item Continuous, adjusted: partial eta-squared from Type II ANOVA table.
\item Continuous, nonparametric: epsilon-squared approximation from Kruskal-Wallis.
\item Categorical: Cramer’s V.
}
}

\subsection{Why the backticks matter}{

This function supports non-syntactic column names (e.g., \code{"sCD163(ng/mL)"}, \code{"PSQI TOTAL"}).
Any internally constructed formulas always backtick variable names so model calls do not fail.
}

\subsection{Method references}{
\itemize{
\item Pearson chi-squared and Fisher’s exact tests: Agresti A. \emph{Categorical Data Analysis}.
\item ANCOVA / linear models: see \code{stats::lm}, \code{stats::aov}.
\item Type II tests: Fox J, Weisberg S. \emph{car} package documentation for \code{Anova}.
\item Estimated marginal means and contrasts: Lenth RV. \emph{emmeans} package documentation.
\item Robust (HC3) covariance: Long & Ervin (2000) and the \code{sandwich} package documentation.
}
}
}
\examples{
\dontrun{
MakeComparisonTable(
  df_Clusters, "Cluster", vars_Predictors,
  Covariates = c("Age","Sex","wrat3"),
  AddEffectSize = TRUE, AddPairwise = TRUE, PairwiseMethod = "none"
)
}
}
