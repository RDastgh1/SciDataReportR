% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MakeComparisonTable.R
\name{MakeComparisonTable}
\alias{MakeComparisonTable}
\title{Make a publication-ready comparison table (gtsummary backbone)}
\usage{
MakeComparisonTable(
  DataFrame,
  CompVariable,
  Variables = NULL,
  ...,
  Covariates = NULL,
  ValueDigits = 2,
  pDigits = 3,
  AddEffectSize = FALSE,
  EffectSizeDigits = 2,
  AddPairwise = FALSE,
  PairwiseMethod = "bonferroni",
  Parametric = TRUE,
  ParametricDisplay = NULL,
  IncludeOverallN = FALSE,
  IncludeMissing = FALSE,
  suppress_warnings = FALSE,
  Referent = NULL,
  IncludeOverallStats = FALSE,
  ShowPositiveBinaryOnLabel = TRUE,
  BinaryPairwiseScale = "logit",
  CatMethod = "auto",
  MultiCatAdjusted = "multinomial_LR",
  IncludeNotes = TRUE
)
}
\arguments{
\item{DataFrame}{A data.frame or tibble.}

\item{CompVariable}{A single character name of the grouping variable.}

\item{Variables}{Character vector of variables to summarize. Default NULL compares all other columns.}

\item{...}{Optional unnamed character variable names to append to Variables.}

\item{Covariates}{Character vector of covariates used only for adjusted tests. Default NULL.}

\item{ValueDigits}{Digits for continuous summaries. Default 2.}

\item{pDigits}{Digits for p-value formatting. Default 3.}

\item{AddEffectSize}{Logical. Add an effect size column. Default FALSE.}

\item{EffectSizeDigits}{Digits for effect size formatting. Default 2.}

\item{AddPairwise}{Logical. Add pairwise columns. Default FALSE.}

\item{PairwiseMethod}{P-adjust method for pairwise tests. Default "bonferroni".
Must be one of \code{stats::p.adjust.methods} or "none". Empty inputs fall back to default.}

\item{Parametric}{Logical. Parametric tests when TRUE; robust or nonparametric when FALSE. Default TRUE.}

\item{ParametricDisplay}{Logical or NULL. If NULL, matches Parametric. Default NULL.}

\item{IncludeOverallN}{Logical. Add overall N via \code{gtsummary::add_n()}. Default FALSE.}

\item{IncludeMissing}{Logical. Include missing rows in summaries. Default FALSE.}

\item{suppress_warnings}{Logical. Suppress warnings from \code{tbl_summary()}. Default FALSE.}

\item{Referent}{Optional single referent level for pairwise. Default NULL.}

\item{IncludeOverallStats}{Logical. If TRUE, returns overall-only summary (ignores grouping). Default FALSE.}

\item{ShowPositiveBinaryOnLabel}{Logical. Attempt to set a “positive” level for dichotomous display. Default TRUE.}

\item{BinaryPairwiseScale}{Character. Reserved. Default "logit". Choices: "logit", "prob".}

\item{CatMethod}{Character. Default "auto". Choices: "auto", "chisq", "fisher".}

\item{MultiCatAdjusted}{Character. Default "multinomial_LR". Choices: "multinomial_LR".}

\item{IncludeNotes}{Logical. Include Notes column and force it last. Default TRUE.}
}
\value{
A \code{gtsummary} \code{tbl_summary} object with added columns in \code{table_body}.
}
\description{
Builds a \code{gtsummary::tbl_summary()} table comparing groups defined by \code{CompVariable},
and appends deterministic, label-friendly columns for global tests, optional adjusted tests,
optional effect sizes, optional pairwise contrasts, and an optional Notes column.
}
\details{
The function is designed to be usable with just:
\preformatted{MakeComparisonTable(df, "Cluster")}
}
\section{Defaults (what happens if you do not set an argument)}{

\itemize{
\item \code{Variables = NULL} (default): compare all columns except \code{CompVariable} and \code{Covariates}.
\item \code{Covariates = NULL} (default): no covariate adjustment.
\item \code{Parametric = TRUE} (default): parametric continuous tests (Welch t-test, ANOVA, ANCOVA).
\item \code{ParametricDisplay = NULL} (default): if NULL, matches \code{Parametric} for display
(mean (SD) if TRUE; median \link{IQR} if FALSE).
\item \code{CatMethod = "auto"} (default): chi-squared when assumptions are adequate, otherwise Fisher.
\item \code{MultiCatAdjusted = "multinomial_LR"} (default): multinomial LR for adjusted multi-category outcomes.
\item \code{AddPairwise = FALSE} (default): no pairwise columns unless enabled.
\item \code{PairwiseMethod = "bonferroni"} (default): multiplicity correction for pairwise p-values.
If \code{PairwiseMethod} is \code{NULL}, \code{""}, \code{NA}, or \code{character(0)}, it falls back to \code{"bonferroni"}.
\item \code{Referent = NULL} (default): all pairwise; if set, do treatment-vs-control vs referent.
\item \code{AddEffectSize = FALSE} (default): effect sizes off unless enabled.
\item \code{IncludeNotes = TRUE} (default): include Notes (set to FALSE to remove). Notes is forced last if included.
}
}

\section{Continuous outcomes}{
 global tests:
\strong{No covariates}
\itemize{
\item \code{Parametric = TRUE}: 2 groups Welch t-test; 3+ groups ANOVA.
\item \code{Parametric = FALSE}: 2 groups Wilcoxon rank-sum; 3+ groups Kruskal-Wallis.
}

\strong{With covariates}
\itemize{
\item \code{Parametric = TRUE}: ANCOVA via \code{lm()} and Type II F test for group term via \code{car::Anova(type = 2)}.
\item \code{Parametric = FALSE}: robust ANCOVA via \code{lm()} with HC3 covariance (\code{sandwich::vcovHC(type="HC3")})
and a Type II Wald F test via \code{car::Anova(vcov.=V, test.statistic="F")}.
}

Complete-case filtering is per-variable:
\itemize{
\item Unadjusted tests filter on \code{outcome + CompVariable}
\item Adjusted tests filter on \code{outcome + CompVariable + Covariates}
This may drop entire group levels.
}

 pairwise tests:
\strong{No covariates}
\itemize{
\item Parametric: \code{stats::pairwise.t.test(pool.sd = FALSE)}.
\item Nonparametric: \code{stats::pairwise.wilcox.test}.
}

\strong{With covariates}
\itemize{
\item Uses \code{emmeans} on the adjusted \code{lm()} model.
\item Robust mode passes HC3 covariance into \code{emmeans::emmeans(..., vcov. = V)} so adjusted pairwise works.
\item \code{Referent} set: treatment-vs-control vs referent; otherwise all pairwise.
}
}

\section{Categorical outcomes}{
 global tests:
\strong{Unadjusted}
\itemize{
\item \code{CatMethod="chisq"}: Pearson chi-squared.
\item \code{CatMethod="fisher"}: Fisher exact for 2x2; simulated Fisher for larger tables.
\item \code{CatMethod="auto"}: chi-squared unless expected counts are small or zero, then Fisher.
}

\strong{Adjusted (with covariates)}
\itemize{
\item Binary outcome: logistic regression likelihood ratio test (LR) for group term.
\item 3+ outcome: multinomial LR (\code{nnet::multinom}) comparing reduced vs full model.
}

 adjusted pairwise:
For each pairwise subset, outcome levels may collapse. The engine detects per pair:
\itemize{
\item If outcome becomes binary: logistic LR.
\item If outcome remains 3+ levels: multinomial LR.
}
}

\section{Notes column}{

With covariates, complete-case filtering can drop group levels for specific variables.
Pairwise contrasts involving dropped levels are returned as \code{NA}. If \code{IncludeNotes=TRUE},
Notes will describe which group levels were dropped. Notes is always the last column if included.
}

\section{P-values}{

Numeric p-values are clamped to at least \code{.Machine$double.xmin} to avoid underflow returning 0.
}

\section{Caption}{

Caption is deterministic and includes: display choice, parametric vs robust mode, covariates (if any),
categorical method, multi-category adjusted method, pairwise inclusion, and p-adjust method.
}

\references{
\itemize{
\item gtsummary: https://www.danieldsjoberg.com/gtsummary/
\item emmeans: https://cran.r-project.org/package=emmeans
\item car::Anova (Type II): https://cran.r-project.org/package=car
\item sandwich::vcovHC (HC3): https://cran.r-project.org/package=sandwich
\item effectsize: https://cran.r-project.org/package=effectsize
\item nnet::multinom: https://cran.r-project.org/package=nnet
}
}
