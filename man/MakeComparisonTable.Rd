% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MakeComparisonTable.R
\name{MakeComparisonTable}
\alias{MakeComparisonTable}
\title{Make comparison table with covariate adjustment, effect sizes, and pairwise contrasts}
\usage{
MakeComparisonTable(
  DataFrame,
  CompVariable = NULL,
  Variables,
  ...,
  Covariates = NULL,
  ValueDigits = 2,
  pDigits = 3,
  AddEffectSize = FALSE,
  EffectSizeDigits = 2,
  AddPairwise = FALSE,
  PairwiseMethod = "bonferroni",
  Parametric = TRUE,
  ParametricDisplay = NULL,
  IncludeOverallN = FALSE,
  IncludeMissing = FALSE,
  suppress_warnings = FALSE,
  Referent = NULL,
  IncludeOverallStats = FALSE,
  ShowPositiveBinaryOnLabel = TRUE,
  BinaryPairwiseScale = c("logit", "prob"),
  CatMethod = c("auto", "chisq", "fisher"),
  MultiCatAdjusted = c("multinomial_LR", "none")
)
}
\arguments{
\item{DataFrame}{A data frame.}

\item{CompVariable}{Grouping variable name (character scalar). If \code{NULL} or not present and
\code{IncludeOverallStats = TRUE}, an overall-only table is returned.}

\item{Variables}{Character vector of variables to include. You may also pass additional
variable names as unnamed arguments via \code{...} (convenience).}

\item{...}{Optional additional variable names (character scalars). Useful when you accidentally
typed \verb{Variables="A", "B"} instead of \code{Variables=c("A","B")}.}

\item{Covariates}{Optional covariate names (character vector) used for adjusted models.
Covariates are automatically removed from \code{Variables} so they do not appear as rows.}

\item{ValueDigits}{Digits for summary statistics (default 2).}

\item{pDigits}{Digits to display in formatted p-values. Formatting uses \code{format.pval}.}

\item{AddEffectSize}{Add effect sizes column (default FALSE).}

\item{EffectSizeDigits}{Digits for effect sizes (default 2).}

\item{AddPairwise}{Add pairwise p-value columns (default FALSE).}

\item{PairwiseMethod}{P-adjustment method (default "bonferroni"). Use "none" for no adjustment.
Must be one of \code{"none"} or \code{stats::p.adjust.methods}.}

\item{Parametric}{If TRUE, use parametric tests for continuous outcomes where relevant.
If FALSE and covariates are present, robust ANCOVA is used for continuous outcomes.}

\item{ParametricDisplay}{If TRUE show mean (SD); if FALSE show median \link{IQR}. Defaults to \code{Parametric}.}

\item{IncludeOverallN}{If TRUE add overall N column.}

\item{IncludeMissing}{If TRUE include missing/unknown category rows in summaries.}

\item{suppress_warnings}{If TRUE suppress gtsummary warnings.}

\item{Referent}{Optional reference level for pairwise contrasts (character scalar). If set,
pairwise comparisons are against this referent.}

\item{IncludeOverallStats}{If TRUE return overall-only summary (ignores grouping).}

\item{ShowPositiveBinaryOnLabel}{If TRUE, display only the “positive” level for binary categorical variables.}

\item{BinaryPairwiseScale}{For adjusted binary outcomes: "logit" (default) returns coefficient-contrast
p-values on the logit scale; "prob" uses a margins-style probability scale approximation.}

\item{CatMethod}{Categorical test method: "chisq" (Pearson), "fisher", or "auto" (default).}

\item{MultiCatAdjusted}{For multi-category categorical outcomes with covariates:
"multinomial_LR" (default) uses multinomial logistic LR global test when possible;
"none" skips adjusted multi-category globals.}
}
\value{
A \code{gtsummary::tbl_summary} object (with added columns in \code{table_body}).
}
\description{
Create a label friendly comparison table (via \strong{gtsummary}) that summarizes variables
across groups, adds global tests, optional covariate adjustment, effect sizes, and
optional pairwise comparisons. Designed for “publication table” workflows where you
want the \strong{Test} column to reflect the method that generated the p-values.
}
\details{
This function is built to survive real world biomedical data, including:
non-syntactic column names (spaces, slashes, parentheses), sparse categorical data,
and models that occasionally refuse to cooperate.
\subsection{Defaults (the ones you asked about)}{
\itemize{
\item \code{CatMethod} defaults to \code{"auto"}.
\item \code{MultiCatAdjusted} defaults to \code{"multinomial_LR"} (so multi-category covariate-adjusted
globals work even when you do not specify it).
}
}

\subsection{What gets tested (global p-value)}{

The global p-value shown for each variable depends on variable type and options.
\subsection{Continuous outcomes}{

\strong{No covariates}
\itemize{
\item \code{Parametric = TRUE}
\itemize{
\item 2 groups: Welch two-sample t test (\code{stats::t.test}, \code{var.equal = FALSE}).
\item 3+ groups: one-way ANOVA (\code{stats::aov}).
}
\item \code{Parametric = FALSE}
\itemize{
\item 2 groups: Wilcoxon rank-sum (\code{stats::wilcox.test}).
\item 3+ groups: Kruskal-Wallis (\code{stats::kruskal.test}).
}
}

\strong{With covariates}
\itemize{
\item \code{Parametric = TRUE}: ANCOVA via linear model (\code{stats::lm}) with Type II test for the
grouping term (\code{car::Anova(type = 2)}).
\item \code{Parametric = FALSE}: Robust ANCOVA using \code{stats::lm} plus HC3 robust covariance
(\code{sandwich::vcovHC(type = "HC3")}) and a Wald F test for the grouping term using
\code{car::linearHypothesis}.
}
}

\subsection{Categorical outcomes}{

\strong{No covariates}
\itemize{
\item Default global test is Pearson chi-squared (\code{stats::chisq.test(correct = FALSE)}).
\item If \code{CatMethod = "auto"}, Fisher’s exact is used when expected counts are small.
For RxC tables, Fisher is computed via simulation (\code{simulate.p.value = TRUE}).
}

\strong{With covariates}
\itemize{
\item Binary outcome: logistic regression LR global test (\code{stats::glm(..., binomial)},
then \code{stats::drop1(test="Chisq")} for the grouping term).
\item Multi-category outcome:
\itemize{
\item If \code{MultiCatAdjusted = "multinomial_LR"} (default): multinomial logistic regression
(\code{nnet::multinom}) with LR Chi-squared test for the grouping term via
\code{car::Anova(type = 2)} when available. If the multinomial machinery fails, the
function falls back to the unadjusted chi-squared or Fisher global test.
\item If \code{MultiCatAdjusted = "none"}: no adjusted global is attempted; unadjusted global is used.
}
}
}

}

\subsection{What gets tested (pairwise p-values)}{

Pairwise p-values are intended to match the method implied by the \strong{Test} column,
but there is one deliberate compromise for multi-category categorical outcomes with
covariates:
\subsection{Continuous outcomes}{
\itemize{
\item No covariates, \code{Parametric = TRUE}: \code{stats::pairwise.t.test(pool.sd = FALSE)}.
\item No covariates, \code{Parametric = FALSE}: \code{stats::pairwise.wilcox.test}.
\item With covariates:
\itemize{
\item \code{Parametric = TRUE}: pairwise comparisons of adjusted means using \code{emmeans::emmeans}
and \code{emmeans::contrast} (pairwise or treatment-vs-control if \code{Referent} is set).
\item \code{Parametric = FALSE}: same as above, but using HC3 robust covariance in emmeans
(\code{emmeans(..., vcov. = V_hc3)}), so pairwise columns populate under robust mode.
}
}
}

\subsection{Categorical outcomes}{
\itemize{
\item No covariates: pairwise Pearson chi-squared or Fisher (depending on \code{CatMethod})
on 2-group subtables.
\item With covariates:
\itemize{
\item Binary: pairwise Wald z tests of linear predictor contrasts from logistic regression.
\item Multi-category: \strong{pairwise are unadjusted 2-group chi-squared or Fisher subtables}
(Option 1). The global p-value can be adjusted (multinomial LR), but the pairwise
comparisons are intentionally kept as simple contingency-table tests because a fully
adjusted multinomial pairwise framework is more complex and far less stable in sparse
biomedical tables.
}
}
}

}

\subsection{Effect sizes}{
\itemize{
\item Continuous, 2 groups, unadjusted: |Cohen’s d| (\code{effectsize::cohens_d}).
\item Continuous, 3+ groups, unadjusted parametric: eta-squared (\code{effectsize::eta_squared}).
\item Continuous, adjusted: partial eta-squared from Type II ANOVA table.
\item Continuous, nonparametric: epsilon-squared approximation from Kruskal-Wallis.
\item Categorical: Cramer’s V.
}
}

\subsection{Why the backticks matter}{

This function supports non-syntactic column names (for example \code{"sCD163(ng/mL)"},
\code{"PSQI TOTAL"}, \code{"CD4/CD8"}). Any internally constructed formulas always backtick
variable names so model calls do not silently fail.
}

\subsection{Practical interpretation of the p-values}{
\itemize{
\item If you supply \code{Covariates}, the printed p-value column is \strong{adjusted when available}
(ANCOVA Type II for continuous parametric, robust Wald for continuous nonparametric,
logistic LR for binary, multinomial LR for multi-category if enabled).
\item If the adjusted model cannot be fit reliably (separation, rank deficiency, etc.),
the function falls back to the unadjusted global test and labels it accordingly.
}
}

\subsection{References}{
\itemize{
\item Agresti A. \emph{Categorical Data Analysis} (chi-squared and Fisher testing).
\item Fox J, Weisberg S. \emph{car} package documentation for Type II/III tests (\code{car::Anova},
\code{car::linearHypothesis}).
\item Lenth RV. \emph{emmeans} package documentation (estimated marginal means and contrasts).
\item Long JS, Ervin LH. (2000). Using heteroscedasticity-consistent standard errors in the
linear regression model (HC3 rationale). See also \code{sandwich} package docs.
\item Venables WN, Ripley BD. \emph{Modern Applied Statistics with S} (multinomial logit via \code{nnet}).
}
}
}
\examples{
\dontrun{
set.seed(1)
df <- data.frame(
  Cluster = factor(sample(1:4, 200, TRUE)),
  `sCD163(ng/mL)` = rlnorm(200, 6, 0.5),
  `PSQI TOTAL` = rnorm(200, 8, 3),
  sex = factor(sample(c("F","M"), 200, TRUE)),
  age = rnorm(200, 50, 10)
)

MakeComparisonTable(df, "Cluster", c("sCD163(ng/mL)", "PSQI TOTAL", "sex"),
  AddEffectSize = TRUE, AddPairwise = TRUE,
  PairwiseMethod = "none", Parametric = TRUE,
  Covariates = c("age", "sex")
)
}
}
