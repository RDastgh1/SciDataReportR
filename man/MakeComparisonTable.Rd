% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MakeComparisonTable.R
\name{MakeComparisonTable}
\alias{MakeComparisonTable}
\title{Make a publication-ready comparison table (gtsummary backbone) with optional adjustment,
effect sizes, and pairwise contrasts}
\usage{
MakeComparisonTable(
  DataFrame,
  CompVariable = NULL,
  Variables,
  ...,
  Covariates = NULL,
  ValueDigits = 2,
  pDigits = 3,
  AddEffectSize = FALSE,
  EffectSizeDigits = 2,
  AddPairwise = FALSE,
  PairwiseMethod = "bonferroni",
  Parametric = TRUE,
  ParametricDisplay = NULL,
  IncludeOverallN = FALSE,
  IncludeMissing = FALSE,
  suppress_warnings = FALSE,
  Referent = NULL,
  IncludeOverallStats = FALSE,
  ShowPositiveBinaryOnLabel = TRUE,
  BinaryPairwiseScale = c("logit", "prob"),
  CatMethod = c("auto", "chisq", "fisher"),
  MultiCatAdjusted = c("multinomial_LR"),
  IncludeNotes = TRUE
)
}
\arguments{
\item{DataFrame}{A data frame.}

\item{CompVariable}{A single character string naming the grouping variable (2+ levels).
If \code{NULL} or if \code{IncludeOverallStats = TRUE}, the function returns an overall-only
table without tests/p-values.}

\item{Variables}{Character vector of variables to summarize and test.}

\item{...}{Unnamed additional variable names to append to \code{Variables}.}

\item{Covariates}{Optional character vector of covariates used only for adjusted models
(global adjusted p-values and adjusted pairwise p-values).
If any covariate names appear in \code{Variables}, they are removed with a warning.}

\item{ValueDigits}{Digits for continuous summary values in the displayed table.}

\item{pDigits}{Digits used when formatting p-values via \code{format.pval()}.}

\item{AddEffectSize}{Logical; if \code{TRUE}, adds an \code{effect_size} column.
Continuous: partial eta squared (η²p). Categorical: Cramér's V (V).}

\item{EffectSizeDigits}{Digits for effect sizes.}

\item{AddPairwise}{Logical; if \code{TRUE}, adds pairwise p-value columns \code{pw_*}.}

\item{PairwiseMethod}{Multiple-comparisons correction for pairwise p-values.
Must be \code{"none"} or one of \code{stats::p.adjust.methods}.}

\item{Parametric}{Logical; if \code{TRUE}, uses parametric tests/models when applicable.
If \code{FALSE}, uses nonparametric tests unadjusted and robust covariance for adjusted
continuous models.}

\item{ParametricDisplay}{Logical; controls only how continuous summaries are displayed.
If \code{NULL}, defaults to \code{Parametric}. \code{TRUE} shows mean (SD); \code{FALSE}
shows median \link{Q1, Q3}.}

\item{IncludeOverallN}{Logical; if \code{TRUE}, adds \code{gtsummary::add_n()}.}

\item{IncludeMissing}{Logical; passed to \code{gtsummary::tbl_summary(missing=)} as
\code{"ifany"} when \code{TRUE}, otherwise \code{"no"}.}

\item{suppress_warnings}{Logical; if \code{TRUE}, suppresses warnings/messages from model fitting
where reasonable (does not suppress your explicit warnings).}

\item{Referent}{Optional single character level of \code{CompVariable} to use as referent for
treatment-versus-control pairwise contrasts. If \code{NULL}, all pairwise contrasts are computed.}

\item{IncludeOverallStats}{Logical; if \code{TRUE}, returns an overall-only table (no tests).}

\item{ShowPositiveBinaryOnLabel}{Logical; if \code{TRUE}, attempts to choose a "positive" level for
dichotomous variables via \code{gtsummary::tbl_summary(value=)} so the row label reads as the
positive category.}

\item{BinaryPairwiseScale}{Character; reserved for future scaling of binary pairwise results.
Currently unused (kept for API stability).}

\item{CatMethod}{Categorical global test method: \code{"auto"}, \code{"chisq"}, or \code{"fisher"}.
\itemize{
\item \code{"chisq"}: Pearson chi-squared (no continuity correction).
\item \code{"fisher"}: Fisher exact for 2x2; simulated Fisher for larger tables.
\item \code{"auto"}: uses chi-squared when assumptions are acceptable (expected counts >= 5),
otherwise Fisher.
}}

\item{MultiCatAdjusted}{Adjusted method for multi-category (3+ levels) outcomes when covariates
are provided. Default is \code{"multinomial_LR"} (multinomial logistic likelihood ratio test).}

\item{IncludeNotes}{Logical; if \code{TRUE}, includes a Notes column and forces it to be the last
column in the output. If \code{FALSE}, Notes is omitted.}
}
\value{
A \code{gtsummary} object (typically \code{tbl_summary}) with additional columns:
\itemize{
\item \code{effect_size} (optional)
\item \code{p.value} (numeric, clamped to avoid underflow to 0)
\item \code{p.value_fmt} (formatted character p-values)
\item \code{Test} (global test label)
\item \code{pw_*} (optional pairwise p-values per contrast)
\item \code{Notes} (optional; documents dropped group levels under complete-case filtering)
}
}
\description{
Creates a label-friendly, predictable comparison table using \pkg{gtsummary} as the backbone
(\code{\link[gtsummary:tbl_summary]{gtsummary::tbl_summary()}}), and then adds deterministic
test metadata columns (global p-values, test names), optional effect sizes, optional pairwise
p-values, and an optional Notes column that documents complete-case group-level dropout.
}
\section{Statistical tests (global)}{

Continuous outcomes (no covariates):
\itemize{
\item Parametric: Welch t-test (2 groups) or ANOVA (3+ groups)
\item Nonparametric: Wilcoxon rank-sum (2 groups) or Kruskal-Wallis (3+ groups)
}

Continuous outcomes (with covariates):
\itemize{
\item Parametric: ANCOVA via \code{lm(outcome ~ group + covariates)} and Type II F test for group term
(\pkg{car} \code{Anova(type=2)}).
\item Robust: same \code{lm} but with HC3 robust covariance (\pkg{sandwich} \code{vcovHC(type="HC3")})
and Type II Wald F test for group term (\pkg{car} \code{Anova(vcov.=V, test.statistic="F")}).
}

Categorical outcomes (no covariates):
\itemize{
\item \code{CatMethod="chisq"}: Pearson chi-squared (no correction)
\item \code{CatMethod="fisher"}: Fisher exact for 2x2, otherwise simulated Fisher (\code{B=10000})
\item \code{CatMethod="auto"}: chi-squared if all expected counts >= 5, else Fisher
}

Categorical outcomes (with covariates):
\itemize{
\item Binary: logistic regression LR test for group term via \code{drop1(test="Chisq")}
\item 3+ levels: multinomial LR test using \pkg{nnet} \code{multinom()} comparing reduced vs full model
}
}

\section{Pairwise tests}{

Continuous outcomes (no covariates):
\itemize{
\item Parametric: pairwise t-tests per contrast (Welch-style), then \code{p.adjust} unless \code{"none"}
\item Nonparametric: pairwise Wilcoxon per contrast, then \code{p.adjust} unless \code{"none"}
}

Continuous outcomes (with covariates):
\itemize{
\item Uses \pkg{emmeans} on the adjusted \code{lm}. In robust mode, passes HC3 covariance to \code{emmeans}
so adjusted pairwise results are still produced.
}

Categorical outcomes (with covariates):
\itemize{
\item For each pairwise subset, detects whether the outcome collapses to binary.
\item If binary in that subset: logistic LR.
\item If still 3+ levels: multinomial LR.
\item P-values are adjusted across pairwise comparisons unless \code{PairwiseMethod="none"}.
}
}

\section{Complete-case filtering and dropped group levels}{

For adjusted models (global adjusted tests and adjusted pairwise), complete-case filtering is performed
per variable on \code{outcome + group + covariates}. This can drop entire group levels for some variables.
Contrasts involving dropped levels return \code{NA}. When \code{IncludeNotes=TRUE}, the Notes column
documents which levels were dropped.
}

\section{P-values}{

Numeric p-values are clamped to at least \code{.Machine$double.xmin} to avoid underflow to 0.
Formatted p-values use \code{format.pval()} and may display \code{"<0.001"}.
}

\examples{
\dontrun{
tbl <- MakeComparisonTable(
  DataFrame = df,
  CompVariable = "Cluster",
  Variables = c("Education_years", "Race"),
  Covariates = c("Age", "Sex"),
  AddPairwise = TRUE,
  Parametric = FALSE,
  PairwiseMethod = "holm",
  AddEffectSize = TRUE,
  IncludeNotes = TRUE
)
tbl \%>\% gtsummary::as_gt()
}

}
\references{
\itemize{
\item Fox J, Weisberg S. An R Companion to Applied Regression (car::Anova Type II tests).
\item Zeileis A. sandwich: Robust covariance matrix estimators (HC3).
\item Lenth RV. emmeans: Estimated marginal means, aka least-squares means.
\item Venables WN, Ripley BD. Modern Applied Statistics with S (nnet::multinom).
}
}
