% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MakeComparisonTable.R
\name{MakeComparisonTable}
\alias{MakeComparisonTable}
\title{Make comparison table with covariate adjustment, effect sizes, and pairwise contrasts}
\usage{
MakeComparisonTable(
  DataFrame,
  CompVariable = NULL,
  Variables,
  ...,
  Covariates = NULL,
  ValueDigits = 2,
  pDigits = 3,
  AddEffectSize = FALSE,
  EffectSizeDigits = 2,
  AddPairwise = FALSE,
  PairwiseMethod = "bonferroni",
  Parametric = TRUE,
  ParametricDisplay = NULL,
  IncludeOverallN = FALSE,
  IncludeMissing = FALSE,
  suppress_warnings = FALSE,
  Referent = NULL,
  IncludeOverallStats = FALSE,
  ShowPositiveBinaryOnLabel = TRUE,
  BinaryPairwiseScale = c("logit", "prob"),
  CatMethod = c("auto", "chisq", "fisher"),
  MultiCatAdjusted = c("multinomial_LR", "none")
)
}
\arguments{
\item{DataFrame}{A data frame.}

\item{CompVariable}{Grouping variable name (character scalar). If \code{NULL} or not present and
\code{IncludeOverallStats=TRUE}, an overall-only table is returned.}

\item{Variables}{Character vector of variables to include. Variables listed as covariates
are automatically dropped from this list so they do not appear as outcomes.}

\item{...}{Optional additional variable names (character scalars).}

\item{Covariates}{Optional covariate names (character vector) used for adjusted models.}

\item{ValueDigits}{Digits for summary statistics (default 2).}

\item{pDigits}{Digits to display in formatted p-values.}

\item{AddEffectSize}{Add effect sizes column (default FALSE).}

\item{EffectSizeDigits}{Digits for effect sizes (default 2).}

\item{AddPairwise}{Add pairwise p-value columns (default FALSE).}

\item{PairwiseMethod}{P-adjustment method (default "bonferroni"). Use "none" for no adjustment.}

\item{Parametric}{If TRUE, use parametric tests for continuous outcomes where relevant.
If FALSE and covariates are present, robust (HC3) inference is used for continuous outcomes.}

\item{ParametricDisplay}{If TRUE show mean (SD); if FALSE show median \link{IQR}. Defaults to \code{Parametric}.}

\item{IncludeOverallN}{If TRUE add overall N column.}

\item{IncludeMissing}{If TRUE include missing/unknown category rows in summaries.}

\item{suppress_warnings}{If TRUE suppress warnings from gtsummary object creation.}

\item{Referent}{Optional reference level for pairwise contrasts (character scalar). If set,
pairwise comparisons are against this referent.}

\item{IncludeOverallStats}{If TRUE return overall-only summary (ignores grouping).}

\item{ShowPositiveBinaryOnLabel}{If TRUE, display only the “positive” level for binary categorical variables.}

\item{BinaryPairwiseScale}{For adjusted binary outcomes: "logit" (default) or "prob".}

\item{CatMethod}{Categorical test method: "auto" (default), "chisq", or "fisher".}

\item{MultiCatAdjusted}{For multi-category categorical outcomes with covariates:
"multinomial_LR" (default) or "none".}
}
\value{
A \code{gtsummary::tbl_summary} object.
}
\description{
Create a label-friendly comparison table (via \strong{gtsummary}) that summarizes variables
across groups, adds global tests, optional covariate adjustment, effect sizes, and
optional pairwise comparisons. Designed for publication workflows where the \strong{Test}
column reflects the method used to compute p-values.
}
\details{
\subsection{Overview}{

This function produces a \code{gtsummary::tbl_summary()} table stratified by \code{CompVariable}
(unless \code{IncludeOverallStats=TRUE}), then adds:
\itemize{
\item \strong{Global p-values} (unadjusted and optionally adjusted for covariates)
\item Optional \strong{effect sizes}
\item Optional \strong{pairwise p-values} between group levels
}

The function is robust to \strong{non-syntactic names} (spaces, slashes, parentheses)
by consistently backticking variables in formulas.
}

\subsection{What gets tested (global p-value)}{

The global p-value shown for each variable depends on variable type and options:
\subsection{Continuous outcomes}{
\itemize{
\item \code{Parametric = TRUE}, no covariates:
\itemize{
\item 2 groups: Welch two-sample t test (\code{stats::t.test}, unequal variances).
\item 3+ groups: one-way ANOVA (\code{stats::aov}).
}
\item Covariates present:
\itemize{
\item \code{Parametric = TRUE}: ANCOVA via \code{stats::lm} with Type II test for the grouping term
(\code{car::Anova(type = 2)}).
\item \code{Parametric = FALSE}: robust ANCOVA via \code{stats::lm} with HC3 robust covariance
(\code{sandwich::vcovHC(type="HC3")}) and a Wald F test (\code{car::linearHypothesis}).
}
}
}

\subsection{Categorical outcomes (binary or multi-category)}{
\itemize{
\item No covariates:
\itemize{
\item Pearson chi-squared (\code{stats::chisq.test(correct=FALSE)}) or Fisher’s exact test depending on \code{CatMethod}.
}
\item Covariates present:
\itemize{
\item \strong{Binary outcomes}: adjusted test via logistic regression LR test
(\code{stats::glm(..., binomial)} + \code{stats::drop1(test="Chisq")} for the grouping term).
\item \strong{Multi-category outcomes} (e.g., Race): adjusted test via multinomial logistic regression LR test
(\code{nnet::multinom} + \code{stats::anova(..., test="Chisq")}) when \code{MultiCatAdjusted="multinomial_LR"}.
}
}
}

}

\subsection{What gets tested (pairwise p-values)}{
\subsection{Continuous outcomes}{
\itemize{
\item No covariates, \code{Parametric=TRUE}: \code{stats::pairwise.t.test(pool.sd=FALSE)}.
\item No covariates, \code{Parametric=FALSE}: \code{stats::pairwise.wilcox.test}.
\item With covariates:
\itemize{
\item Pairwise comparisons of adjusted means using \code{emmeans::emmeans} + \code{emmeans::contrast}.
\item If \code{Parametric=FALSE}, inference uses \strong{HC3 robust covariance} supplied to \code{emmeans}
(\code{emmeans(..., vcov. = sandwich::vcovHC(fit, type="HC3"))}).
}
}
}

\subsection{Categorical outcomes}{
\itemize{
\item No covariates: pairwise chi-sq or Fisher on 2-group subtables.
\item With covariates:
\itemize{
\item \strong{Binary}: logistic coefficient-contrast style pairwise (Wald z tests on logit scale by default).
\item \strong{Multi-category}: pairwise LR tests using multinomial logit:
\itemize{
\item Subset to two clusters
\item Compare \code{outcome ~ Cluster + covariates} vs \code{outcome ~ covariates}
}
}
}
}

}

\subsection{Effect sizes}{
\itemize{
\item Continuous, 2 groups, unadjusted: |Cohen’s d| (\code{effectsize::cohens_d}).
\item Continuous, 3+ groups, unadjusted parametric: eta-squared (\code{effectsize::eta_squared}).
\item Continuous, adjusted: partial eta-squared from Type II ANOVA table.
\item Continuous, nonparametric: epsilon-squared approximation from Kruskal-Wallis.
\item Categorical: Cramer’s V.
}
}

\subsection{Warnings you may see (and what they mean)}{
\itemize{
\item "Chi-squared approximation may be incorrect": sparse expected counts; prefer \code{CatMethod="auto"} (Fisher fallback).
\item \code{glm.fit} warnings about separation/non-convergence: rare binary outcomes in some groups. The function
returns p-values when possible; otherwise \code{NA}.
\item Multinomial warnings: sparse category-by-cluster cells may cause instability; \code{NA} is returned if the model fails.
}
}

\subsection{Method references}{
\itemize{
\item Agresti A. \emph{Categorical Data Analysis} (chi-sq, Fisher, logistic, multinomial models).
\item Fox J, Weisberg S. \emph{car} package documentation for Type II tests and Wald tests.
\item Lenth RV. \emph{emmeans} package documentation for adjusted means and contrasts.
\item Long & Ervin (2000) and \code{sandwich} package docs for HC3 robust covariance.
}
}
}
